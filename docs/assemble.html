---

title: assemble


keywords: fastai
sidebar: home_sidebar

summary: "High-level functions to tidy up already parsed data"
description: "High-level functions to tidy up already parsed data"
nb_path: "60_assemble.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 60_assemble.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Directory where the zip files are stored</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">directory</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;samples&#39;</span>
<span class="k">assert</span> <span class="n">directory</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="n">directory</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>PosixPath(&#39;/home/manu/dlsproc/samples&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Zip-file">Zip file<a class="anchor-link" href="#Zip-file"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A (sample) file in that directory</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">input_file</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">/</span> <span class="s1">&#39;PlataformasAgregadasSinMenores_202201_05-06.zip&#39;</span>
<span class="k">assert</span> <span class="n">input_file</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="n">input_file</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>PosixPath(&#39;/home/manu/dlsproc/samples/PlataformasAgregadasSinMenores_202201_05-06.zip&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">dlsproc</span><span class="o">.</span><span class="n">hier</span><span class="o">.</span><span class="n">flat_df_to_multiindexed_df</span><span class="p">(</span><span class="n">dlsproc</span><span class="o">.</span><span class="n">bundle</span><span class="o">.</span><span class="n">read_zip</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">concatenate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>id</th>
      <th>summary</th>
      <th>title</th>
      <th>updated</th>
      <th colspan="17" halign="left">ContractFolderStatus</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>ContractFolderID</th>
      <th>ContractFolderStatusCode</th>
      <th colspan="3" halign="left">LocatedContractingParty</th>
      <th colspan="3" halign="left">ProcurementProject</th>
      <th colspan="2" halign="left">LegalDocumentReference</th>
      <th>ProcurementProject</th>
      <th colspan="2" halign="left">TechnicalDocumentReference</th>
      <th>LocatedContractingParty</th>
      <th colspan="3" halign="left">TenderingProcess</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>BuyerProfileURIID</th>
      <th>Party</th>
      <th>ParentLocatedParty</th>
      <th>Name</th>
      <th>...</th>
      <th>PlannedPeriod</th>
      <th>ID</th>
      <th>Attachment</th>
      <th>PlannedPeriod</th>
      <th>ID</th>
      <th>Attachment</th>
      <th>ParentLocatedParty</th>
      <th colspan="2" halign="left">ParticipationRequestReceptionPeriod</th>
      <th>TenderSubmissionDeadlinePeriod</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>PartyName</th>
      <th>PartyName</th>
      <th></th>
      <th>...</th>
      <th>StartDate</th>
      <th></th>
      <th>ExternalReference</th>
      <th>EndDate</th>
      <th></th>
      <th>ExternalReference</th>
      <th>ParentLocatedParty</th>
      <th>EndDate</th>
      <th>EndTime</th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>Name</th>
      <th>Name</th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th>URI</th>
      <th></th>
      <th></th>
      <th>URI</th>
      <th>PartyName</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>Name</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th>file name</th>
      <th>entry</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">PlataformasAgregadasSinMenores_20220105_030012.atom</th>
      <th>0</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Id licitación: 2021039438; Órgano de Contratac...</td>
      <td>L'objecte és la contractació del servei de bug...</td>
      <td>2022-01-04 12:12:09.464000+00:00</td>
      <td>2021039438</td>
      <td>RES</td>
      <td>https://contractaciopublica.gencat.cat/ecofin_...</td>
      <td>Ajuntament de Girona</td>
      <td>Entitats municipals de Catalunya</td>
      <td>L'objecte és la contractació del servei de bug...</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2021-12-13 23:59:00+00:00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Id licitación: 2021_2568; Órgano de Contrataci...</td>
      <td>Servei comunicacions postals de l'Ajuntament d...</td>
      <td>2022-01-04 12:12:09.400000+00:00</td>
      <td>2021_2568</td>
      <td>ADJ</td>
      <td>https://contractaciopublica.gencat.cat/ecofin_...</td>
      <td>Ajuntament de Collbató</td>
      <td>Entitats municipals de Catalunya</td>
      <td>Servei comunicacions postals de l'Ajuntament d...</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2021-11-29 23:59:00+00:00</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 39 columns</p>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The last few columns</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>MultiIndex([(&#39;ContractFolderStatus&#39;, &#39;TenderingProcess&#39;, ...),
            (&#39;ContractFolderStatus&#39;, &#39;TenderingProcess&#39;, ...)],
           )</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Deleted contracts are extracted</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">deleted_df</span> <span class="o">=</span> <span class="n">dlsproc</span><span class="o">.</span><span class="n">bundle</span><span class="o">.</span><span class="n">read_deleted_zip</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
<span class="n">deleted_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>file name                                            id                                                                                 
PlataformasAgregadasSinMenores_20220105_030012.atom  https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/6724977   2022-01-04 01:12:01.376000+01:00
                                                     https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968315   2022-01-04 00:11:57.567000+01:00
Name: deleted_on, dtype: datetime64[ns, pytz.FixedOffset(60)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Handling-deleted-entries">Handling deleted entries<a class="anchor-link" href="#Handling-deleted-entries"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="merge_deleted" class="doc_header"><code>merge_deleted</code><a href="https://github.com/manuvazquez/dlsproc/tree/master/dlsproc/assemble.py#L16" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>merge_deleted</code>(<strong><code>data_df</code></strong>:<code>DataFrame</code>, <strong><code>deleted_series</code></strong>:<code>Series</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">merged_df</span> <span class="o">=</span> <span class="n">merge_deleted</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">deleted_df</span><span class="p">)</span>
<span class="n">merged_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>entry</th>
      <th>summary</th>
      <th>title</th>
      <th>updated</th>
      <th colspan="16" halign="left">ContractFolderStatus</th>
      <th>deleted_on</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>ContractFolderID</th>
      <th>ContractFolderStatusCode</th>
      <th colspan="3" halign="left">LocatedContractingParty</th>
      <th>ProcurementProject</th>
      <th>...</th>
      <th colspan="2" halign="left">LegalDocumentReference</th>
      <th>ProcurementProject</th>
      <th colspan="2" halign="left">TechnicalDocumentReference</th>
      <th>LocatedContractingParty</th>
      <th colspan="3" halign="left">TenderingProcess</th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>BuyerProfileURIID</th>
      <th>Party</th>
      <th>ParentLocatedParty</th>
      <th>Name</th>
      <th>...</th>
      <th>ID</th>
      <th>Attachment</th>
      <th>PlannedPeriod</th>
      <th>ID</th>
      <th>Attachment</th>
      <th>ParentLocatedParty</th>
      <th colspan="2" halign="left">ParticipationRequestReceptionPeriod</th>
      <th>TenderSubmissionDeadlinePeriod</th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>PartyName</th>
      <th>PartyName</th>
      <th></th>
      <th>...</th>
      <th></th>
      <th>ExternalReference</th>
      <th>EndDate</th>
      <th></th>
      <th>ExternalReference</th>
      <th>ParentLocatedParty</th>
      <th>EndDate</th>
      <th>EndTime</th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>Name</th>
      <th>Name</th>
      <th></th>
      <th>...</th>
      <th></th>
      <th>URI</th>
      <th></th>
      <th></th>
      <th>URI</th>
      <th>PartyName</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>Name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th>file name</th>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">PlataformasAgregadasSinMenores_20220105_030012.atom</th>
      <th>https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/8769544</th>
      <td>0</td>
      <td>Id licitación: 2021039438; Órgano de Contratac...</td>
      <td>L'objecte és la contractació del servei de bug...</td>
      <td>2022-01-04 12:12:09.464000+00:00</td>
      <td>2021039438</td>
      <td>RES</td>
      <td>https://contractaciopublica.gencat.cat/ecofin_...</td>
      <td>Ajuntament de Girona</td>
      <td>Entitats municipals de Catalunya</td>
      <td>L'objecte és la contractació del servei de bug...</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2021-12-13 23:59:00+00:00</td>
      <td>NaT</td>
    </tr>
    <tr>
      <th>https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/8692029</th>
      <td>1</td>
      <td>Id licitación: 2021_2568; Órgano de Contrataci...</td>
      <td>Servei comunicacions postals de l'Ajuntament d...</td>
      <td>2022-01-04 12:12:09.400000+00:00</td>
      <td>2021_2568</td>
      <td>ADJ</td>
      <td>https://contractaciopublica.gencat.cat/ecofin_...</td>
      <td>Ajuntament de Collbató</td>
      <td>Entitats municipals de Catalunya</td>
      <td>Servei comunicacions postals de l'Ajuntament d...</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2021-11-29 23:59:00+00:00</td>
      <td>NaT</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 40 columns</p>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The new <em>merged</em> <code>pd.DataFrame</code> has the same number of rows as the original one</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">merged_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>How many entries have been deleted?</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;deleted_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Some examples</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

