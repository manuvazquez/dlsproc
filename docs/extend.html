---

title: extend


keywords: fastai
sidebar: home_sidebar

summary: "Extend an already existing `pd.DataFrame` with new data"
description: "Extend an already existing `pd.DataFrame` with new data"
nb_path: "70_extend.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 70_extend.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These <code>import</code>s are not actually needed by the final <em>exported</em> code</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Historical-data">Historical data<a class="anchor-link" href="#Historical-data"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Directory from which to read historical data</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">history_directory</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s1">'samples'</span>
<span class="c1"># history_directory = pathlib.Path.cwd() / 'reports'</span>
<span class="k">assert</span> <span class="n">history_directory</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">history_directory</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/home/manu/dlsproc/samples
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Input directory for the <code>pd.DataFrame</code> to be updated</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">history_input_file</span> <span class="o">=</span> <span class="n">history_directory</span> <span class="o">/</span> <span class="s1">'2018-2021_20samples.parquet'</span>
<span class="c1"># history_input_file = history_directory / '2018-2021.parquet'</span>
<span class="k">assert</span> <span class="n">history_input_file</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">history_input_file</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/home/manu/dlsproc/samples/2018-2021_20samples.parquet
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The specific file is</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">history_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">history_input_file</span><span class="p">)</span>
<span class="n">history_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>id</th>
      <th>summary</th>
      <th>title</th>
      <th>updated</th>
      <th colspan="16" halign="left">ContractFolderStatus</th>
      <th>deleted_on</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>ContractFolderID</th>
      <th>ContractFolderStatusCode</th>
      <th colspan="2" halign="left">LocatedContractingParty</th>
      <th colspan="2" halign="left">ProcurementProject</th>
      <th>...</th>
      <th colspan="2" halign="left">LegalDocumentReference</th>
      <th colspan="2" halign="left">TechnicalDocumentReference</th>
      <th colspan="2" halign="left">LocatedContractingParty</th>
      <th colspan="3" halign="left">TenderingProcess</th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">Party</th>
      <th>Name</th>
      <th>TypeCode</th>
      <th>...</th>
      <th>ID</th>
      <th>Attachment</th>
      <th>ID</th>
      <th>Attachment</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th colspan="2" halign="left">ParticipationRequestReceptionPeriod</th>
      <th>TenderSubmissionDeadlinePeriod</th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>PartyIdentification</th>
      <th>PartyName</th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th>ExternalReference</th>
      <th></th>
      <th>ExternalReference</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th>EndDate</th>
      <th>EndTime</th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th>URI</th>
      <th></th>
      <th>URI</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>PartyName</th>
      <th>ParentLocatedParty</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>Name</th>
      <th>PartyName</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>Name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th>file name</th>
      <th>entry</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">PlataformasAgregadasSinMenores_20180217_180137_1.atom</th>
      <th>453</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Expediente: 1284/17, Entidad: Diputación Provi...</td>
      <td>Refuerzo de Firme en la VP 3001 Renedo de Esgu...</td>
      <td>2018-01-02 08:01:52.024000+00:00</td>
      <td>1284/17</td>
      <td>RES</td>
      <td>L02000047</td>
      <td>Diputación Provincial de Valladolid</td>
      <td>Refuerzo de Firme en la VP 3001 Renedo de Esgu...</td>
      <td>3.0</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2017-11-02</td>
      <td>23:59:00</td>
      <td>2017-11-02 23:59:00+00:00</td>
      <td>NaT</td>
    </tr>
    <tr>
      <th>452</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Expediente: 1282/17, Entidad: Diputación Provi...</td>
      <td>Refuerzo de Firme en la VP 6603 Mota del Marqu...</td>
      <td>2018-01-02 08:02:24.833000+00:00</td>
      <td>1282/17</td>
      <td>RES</td>
      <td>L02000047</td>
      <td>Diputación Provincial de Valladolid</td>
      <td>Refuerzo de Firme en la VP 6603 Mota del Marqu...</td>
      <td>3.0</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2017-11-02</td>
      <td>23:59:00</td>
      <td>2017-11-02 23:59:00+00:00</td>
      <td>NaT</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 41 columns</p>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="New-data">New data<a class="anchor-link" href="#New-data"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The directory for the zip file whose data is to appended to the already existing <code>pd.DataFrame</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">zip_directory</span> <span class="o">=</span> <span class="n">history_directory</span>
<span class="c1"># zip_directory = pathlib.Path.cwd() / 'data' / 'agregados'</span>
<span class="k">assert</span> <span class="n">zip_directory</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">zip_directory</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/home/manu/dlsproc/samples
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The particular file</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">zip_file</span> <span class="o">=</span> <span class="n">zip_directory</span> <span class="o">/</span> <span class="s1">'PlataformasAgregadasSinMenores_202201_05-06.zip'</span>
<span class="c1"># zip_file = zip_directory / 'PlataformasAgregadasSinMenores_202201.zip'</span>
<span class="k">assert</span> <span class="n">zip_file</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">zip_file</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/home/manu/dlsproc/samples/PlataformasAgregadasSinMenores_202201_05-06.zip
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The file is read and processed in the usual way to get a <code>pd.DataFrame</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">new_df</span> <span class="o">=</span> <span class="n">dlsproc</span><span class="o">.</span><span class="n">bundle</span><span class="o">.</span><span class="n">read_zip</span><span class="p">(</span><span class="n">zip_file</span><span class="p">,</span> <span class="n">concatenate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>Multindexed</em> columns are built</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">new_df</span> <span class="o">=</span> <span class="n">dlsproc</span><span class="o">.</span><span class="n">hier</span><span class="o">.</span><span class="n">flat_df_to_multiindexed_df</span><span class="p">(</span><span class="n">new_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Number of levels in the columns</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">new_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">nlevels</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>6</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Information about deleted entries</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">deleted_series</span> <span class="o">=</span> <span class="n">dlsproc</span><span class="o">.</span><span class="n">bundle</span><span class="o">.</span><span class="n">read_deleted_zip</span><span class="p">(</span><span class="n">zip_file</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Merge">Merge<a class="anchor-link" href="#Merge"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Old and new data are stacked together</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">concatenated_df</span> <span class="o">=</span> <span class="n">dlsproc</span><span class="o">.</span><span class="n">assemble</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">history_df</span><span class="p">,</span> <span class="n">new_df</span><span class="p">)</span>
<span class="n">concatenated_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>id</th>
      <th>summary</th>
      <th>title</th>
      <th>updated</th>
      <th colspan="15" halign="left">ContractFolderStatus</th>
      <th>deleted_on</th>
      <th>ContractFolderStatus</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>ContractFolderID</th>
      <th>ContractFolderStatusCode</th>
      <th colspan="2" halign="left">LocatedContractingParty</th>
      <th colspan="2" halign="left">ProcurementProject</th>
      <th>...</th>
      <th>LegalDocumentReference</th>
      <th colspan="2" halign="left">TechnicalDocumentReference</th>
      <th colspan="2" halign="left">LocatedContractingParty</th>
      <th colspan="3" halign="left">TenderingProcess</th>
      <th></th>
      <th>LocatedContractingParty</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">Party</th>
      <th>Name</th>
      <th>TypeCode</th>
      <th>...</th>
      <th>Attachment</th>
      <th>ID</th>
      <th>Attachment</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th colspan="2" halign="left">ParticipationRequestReceptionPeriod</th>
      <th>TenderSubmissionDeadlinePeriod</th>
      <th></th>
      <th>BuyerProfileURIID</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>PartyIdentification</th>
      <th>PartyName</th>
      <th></th>
      <th></th>
      <th>...</th>
      <th>ExternalReference</th>
      <th></th>
      <th>ExternalReference</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th>EndDate</th>
      <th>EndTime</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th></th>
      <th></th>
      <th>...</th>
      <th>URI</th>
      <th></th>
      <th>URI</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th>PartyName</th>
      <th>ParentLocatedParty</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th>Name</th>
      <th>PartyName</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>Name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th>file name</th>
      <th>entry</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">PlataformasAgregadasSinMenores_20180217_180137_1.atom</th>
      <th>453</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Expediente: 1284/17, Entidad: Diputación Provi...</td>
      <td>Refuerzo de Firme en la VP 3001 Renedo de Esgu...</td>
      <td>2018-01-02 08:01:52.024000+00:00</td>
      <td>1284/17</td>
      <td>RES</td>
      <td>L02000047</td>
      <td>Diputación Provincial de Valladolid</td>
      <td>Refuerzo de Firme en la VP 3001 Renedo de Esgu...</td>
      <td>3.0</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2017-11-02</td>
      <td>23:59:00</td>
      <td>2017-11-02 23:59:00+00:00</td>
      <td>NaT</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>452</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Expediente: 1282/17, Entidad: Diputación Provi...</td>
      <td>Refuerzo de Firme en la VP 6603 Mota del Marqu...</td>
      <td>2018-01-02 08:02:24.833000+00:00</td>
      <td>1282/17</td>
      <td>RES</td>
      <td>L02000047</td>
      <td>Diputación Provincial de Valladolid</td>
      <td>Refuerzo de Firme en la VP 6603 Mota del Marqu...</td>
      <td>3.0</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2017-11-02</td>
      <td>23:59:00</td>
      <td>2017-11-02 23:59:00+00:00</td>
      <td>NaT</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>451</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Expediente: 1281/17, Entidad: Diputación Provi...</td>
      <td>Refuerzo de firme en la VP 4013 Melgar de Arri...</td>
      <td>2018-01-02 08:02:51.744000+00:00</td>
      <td>1281/17</td>
      <td>RES</td>
      <td>L02000047</td>
      <td>Diputación Provincial de Valladolid</td>
      <td>Refuerzo de firme en la VP 4013 Melgar de Arri...</td>
      <td>3.0</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2017-11-02</td>
      <td>23:59:00</td>
      <td>2017-11-02 23:59:00+00:00</td>
      <td>NaT</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>450</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Id licitación: VI/17/04-015; Órgano de Contrat...</td>
      <td>Obras de edificación en el barrio de Pumarabul...</td>
      <td>2018-01-02 08:02:56.115000+00:00</td>
      <td>VI/17/04-015</td>
      <td>EV</td>
      <td>&lt;NA&gt;</td>
      <td>Consejería de Servicios y Derechos Sociales</td>
      <td>Edificación de 36 VPP, garaje y trasteros en e...</td>
      <td>3.0</td>
      <td>...</td>
      <td>http://www.asturias.es/Proveedores/FICHEROS/ES...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2017-12-11 14:00:00+00:00</td>
      <td>NaT</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>449</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Id Licitación: PcPG/2017/194222, Órgano de Con...</td>
      <td>Suministro de gas natural canalizado y gas nat...</td>
      <td>2018-01-02 09:10:49.572000+00:00</td>
      <td>PcPG/2017/194222</td>
      <td>ADJ</td>
      <td>A12017369</td>
      <td>Consellería de Economía, Emprego e Industria</td>
      <td>Suministro de gas natural canalizado y gas nat...</td>
      <td>1.0</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2017-09-29 23:59:00+00:00</td>
      <td>NaT</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">PlataformasAgregadasSinMenores_20220106_030013.atom</th>
      <th>471</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Id licitación: 2021/57-12334; Órgano de Contra...</td>
      <td>L'objecte d'aquest contracte és la prestació c...</td>
      <td>2022-01-04 12:12:09.949000+00:00</td>
      <td>2021/57-12334</td>
      <td>PUB</td>
      <td>&lt;NA&gt;</td>
      <td>Ajuntament de Palau-solità i Plegamans</td>
      <td>L'objecte d'aquest contracte és la prestació c...</td>
      <td>1.0</td>
      <td>...</td>
      <td>https://contractaciopublica.gencat.cat/ecofin_...</td>
      <td>PPT_subministrament 8 cameres videovigilancia_...</td>
      <td>https://contractaciopublica.gencat.cat/ecofin_...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2022-01-19 15:00:00+00:00</td>
      <td>NaT</td>
      <td>https://contractaciopublica.gencat.cat/ecofin_...</td>
    </tr>
    <tr>
      <th>472</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Id licitación: 32/2021; Órgano de Contratación...</td>
      <td>Licitació per procediment obert harmonitzat i ...</td>
      <td>2022-01-04 12:12:09.742000+00:00</td>
      <td>32/2021</td>
      <td>RES</td>
      <td>&lt;NA&gt;</td>
      <td>Consell Comarcal del Baix Llobregat</td>
      <td>Licitació per procediment obert harmonitzat i ...</td>
      <td>2.0</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2021-05-07 15:00:00+00:00</td>
      <td>NaT</td>
      <td>https://contractaciopublica.gencat.cat/ecofin_...</td>
    </tr>
    <tr>
      <th>473</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Id licitación: 1977/2021; Órgano de Contrataci...</td>
      <td>L'objecte d'aquest contracte és la prestació d...</td>
      <td>2022-01-04 12:12:09.666000+00:00</td>
      <td>1977/2021</td>
      <td>RES</td>
      <td>&lt;NA&gt;</td>
      <td>Ajuntament de Sant Adrià de Besòs</td>
      <td>L'objecte d'aquest contracte és la prestació d...</td>
      <td>2.0</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2021-06-30 23:59:00+00:00</td>
      <td>NaT</td>
      <td>https://contractaciopublica.gencat.cat/ecofin_...</td>
    </tr>
    <tr>
      <th>474</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Id licitación: EXI-2022-7; Órgano de Contratac...</td>
      <td>Servei de trasllat de béns mobles( mobiliari, ...</td>
      <td>2022-01-04 12:12:09.602000+00:00</td>
      <td>EXI-2022-7</td>
      <td>ADJ</td>
      <td>&lt;NA&gt;</td>
      <td>Departament d'Acció Exterior i Govern Obert</td>
      <td>Servei de trasllat de béns mobles( mobiliari, ...</td>
      <td>2.0</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2021-12-13 13:00:00+00:00</td>
      <td>NaT</td>
      <td>https://contractaciopublica.gencat.cat/ecofin_...</td>
    </tr>
    <tr>
      <th>475</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Id licitación: CONTR/2021/000000137; Órgano de...</td>
      <td>Servei de redacció del Projecte Executiu d'obr...</td>
      <td>2022-01-04 12:12:09.536000+00:00</td>
      <td>CONTR/2021/000000137</td>
      <td>ADJ</td>
      <td>&lt;NA&gt;</td>
      <td>Institut d'Assistència Sanitària (IAS)</td>
      <td>Servei de redacció del Projecte Executiu d'obr...</td>
      <td>2.0</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2021-11-10 18:00:00+00:00</td>
      <td>NaT</td>
      <td>https://contractaciopublica.gencat.cat/ecofin_...</td>
    </tr>
  </tbody>
</table>
<p>971 rows × 42 columns</p>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Only the last update is kept</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">concatenated_df</span> <span class="o">=</span> <span class="n">dlsproc</span><span class="o">.</span><span class="n">postprocess</span><span class="o">.</span><span class="n">keep_updates_only</span><span class="p">(</span><span class="n">concatenated_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In order to make it easy to update the <code>deleted_on</code> column in the existing <code>pd.DataFrame</code> using the data contained in the <em>deleted</em> <code>pd.Series</code> (i.e., to get <em>automatic 
alignment</em>) we</p>
<ul>
<li>reindex the dataframe using <code>id</code></li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">reindexed_concatenated_df</span> <span class="o">=</span> <span class="n">concatenated_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">'id'</span><span class="p">])</span>
<span class="n">reindexed_concatenated_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>file name</th>
      <th>entry</th>
      <th>summary</th>
      <th>title</th>
      <th>updated</th>
      <th colspan="14" halign="left">ContractFolderStatus</th>
      <th>deleted_on</th>
      <th>ContractFolderStatus</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>ContractFolderID</th>
      <th>ContractFolderStatusCode</th>
      <th colspan="2" halign="left">LocatedContractingParty</th>
      <th>ProcurementProject</th>
      <th>...</th>
      <th>LegalDocumentReference</th>
      <th colspan="2" halign="left">TechnicalDocumentReference</th>
      <th colspan="2" halign="left">LocatedContractingParty</th>
      <th colspan="3" halign="left">TenderingProcess</th>
      <th></th>
      <th>LocatedContractingParty</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">Party</th>
      <th>Name</th>
      <th>...</th>
      <th>Attachment</th>
      <th>ID</th>
      <th>Attachment</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th colspan="2" halign="left">ParticipationRequestReceptionPeriod</th>
      <th>TenderSubmissionDeadlinePeriod</th>
      <th></th>
      <th>BuyerProfileURIID</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>PartyIdentification</th>
      <th>PartyName</th>
      <th></th>
      <th>...</th>
      <th>ExternalReference</th>
      <th></th>
      <th>ExternalReference</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th>EndDate</th>
      <th>EndTime</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th></th>
      <th>...</th>
      <th>URI</th>
      <th></th>
      <th>URI</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th>PartyName</th>
      <th>ParentLocatedParty</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th>Name</th>
      <th>PartyName</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>Name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1992428</th>
      <td>PlataformasAgregadasSinMenores_20180217_180137...</td>
      <td>453</td>
      <td>Expediente: 1284/17, Entidad: Diputación Provi...</td>
      <td>Refuerzo de Firme en la VP 3001 Renedo de Esgu...</td>
      <td>2018-01-02 08:01:52.024000+00:00</td>
      <td>1284/17</td>
      <td>RES</td>
      <td>L02000047</td>
      <td>Diputación Provincial de Valladolid</td>
      <td>Refuerzo de Firme en la VP 3001 Renedo de Esgu...</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2017-11-02</td>
      <td>23:59:00</td>
      <td>2017-11-02 23:59:00+00:00</td>
      <td>NaT</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1992427</th>
      <td>PlataformasAgregadasSinMenores_20180217_180137...</td>
      <td>452</td>
      <td>Expediente: 1282/17, Entidad: Diputación Provi...</td>
      <td>Refuerzo de Firme en la VP 6603 Mota del Marqu...</td>
      <td>2018-01-02 08:02:24.833000+00:00</td>
      <td>1282/17</td>
      <td>RES</td>
      <td>L02000047</td>
      <td>Diputación Provincial de Valladolid</td>
      <td>Refuerzo de Firme en la VP 6603 Mota del Marqu...</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2017-11-02</td>
      <td>23:59:00</td>
      <td>2017-11-02 23:59:00+00:00</td>
      <td>NaT</td>
      <td>&lt;NA&gt;</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 43 columns</p>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>drop the first level of the series (which leaves only <code>id</code>)</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">reindexed_deleted_series</span> <span class="o">=</span> <span class="n">deleted_series</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">reindexed_deleted_series</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>id
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/6724977   2022-01-04 00:12:01.376000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968315   2022-01-03 23:11:57.567000+00:00
Name: deleted_on, dtype: datetime64[ns, UTC]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Duplicates are removed from the above <code>pd.Series</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">deduplicated_reindexed_deleted_series</span> <span class="o">=</span> <span class="n">dlsproc</span><span class="o">.</span><span class="n">postprocess</span><span class="o">.</span><span class="n">deduplicate_deleted_series</span><span class="p">(</span><span class="n">reindexed_deleted_series</span><span class="p">)</span>
<span class="n">deduplicated_reindexed_deleted_series</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>id
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1957921   2022-01-03 23:11:56.535000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1959074   2022-01-03 23:11:56.497000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968266   2022-01-04 23:12:11.916000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968267   2022-01-04 23:12:12.775000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968268   2022-01-04 23:12:12.731000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968269   2022-01-04 23:12:13.013000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968271   2022-01-04 23:12:12.172000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968272   2022-01-04 23:12:12.957000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968279   2022-01-04 23:12:12.039000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968280   2022-01-04 23:12:12.865000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968282   2022-01-04 23:12:13.107000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968284   2022-01-04 23:12:12.911000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968285   2022-01-04 23:12:12.819000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968286   2022-01-04 23:12:13.147000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968287   2022-01-04 23:12:11.998000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968288   2022-01-04 23:12:11.957000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968289   2022-01-04 23:12:12.129000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968290   2022-01-04 23:12:12.635000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968291   2022-01-04 23:12:13.191000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968294   2022-01-04 23:12:13.328000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968299   2022-01-04 23:12:13.236000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968301   2022-01-04 23:12:13.283000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968302   2022-01-04 23:12:12.680000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968303   2022-01-04 23:12:13.058000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968305   2022-01-04 23:12:12.076000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968315   2022-01-03 23:11:57.567000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968317   2022-01-03 23:11:56.751000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968318   2022-01-03 23:11:57.038000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968319   2022-01-03 23:11:56.620000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968321   2022-01-03 23:11:57.323000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968324   2022-01-03 23:11:57.471000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968325   2022-01-03 23:11:56.579000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968327   2022-01-03 23:11:57.089000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968329   2022-01-03 23:11:56.850000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968331   2022-01-03 23:11:56.897000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968332   2022-01-03 23:11:56.949000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968333   2022-01-03 23:11:57.183000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968335   2022-01-03 23:11:57.275000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968337   2022-01-03 23:11:57.375000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968338   2022-01-03 23:11:56.805000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968343   2022-01-03 23:11:57.232000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968344   2022-01-03 23:11:57.426000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968345   2022-01-03 23:11:57.516000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968346   2022-01-03 23:11:56.661000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968358   2022-01-03 23:11:56.706000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968360   2022-01-03 23:11:57.141000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968361   2022-01-03 23:11:56.991000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/6724977   2022-01-04 00:12:01.376000+00:00
https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/8892704   2022-01-04 13:13:12.670000+00:00
Name: deleted_on, dtype: datetime64[ns, UTC]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The old and new sizes</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">reindexed_deleted_series</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">deduplicated_reindexed_deleted_series</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((49,), (49,))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>No keys are lost along the way</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">reindexed_deleted_series</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">deduplicated_reindexed_deleted_series</span><span class="o">.</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="nb">set</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Duplicates in the old <code>pd.Series</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">reindexed_deleted_series</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reindexed_deleted_series</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Series([], Name: deleted_on, dtype: datetime64[ns, UTC])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There should be none in the new</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">deduplicated_reindexed_deleted_series</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">deduplicated_reindexed_deleted_series</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span><span class="o">.</span><span class="n">empty</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>What is the intersection between the entries in the new <code>pd.DataFrame</code> and the series with information about deletes (only the first elements).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">reindexed_concatenated_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">deduplicated_reindexed_deleted_series</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A deleted entry, identified by its <code>id</code>, and also showing the source <em>ATOM</em> file</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">deleted_entry</span> <span class="o">=</span> <span class="n">deduplicated_reindexed_deleted_series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">deleted_entry</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1957921&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It's not actually present in the data</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">new_df</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">==</span> <span class="n">deleted_entry</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In order to see if something changes when updating column <code>deleted_on</code>, a backup of the old <code>pd.DataFrame</code> is made</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bak_reindexed_concatenated_df</span> <span class="o">=</span> <span class="n">reindexed_concatenated_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The columns <code>deleted_on</code> in the <code>pd.DataFrame</code> is updated for the indexes present in the <em>deleted series</em>. Notice that we cannot do</p>

<pre><code>reindexed_concatenated_df['deleted_on'] = deduplicated_reindexed_deleted_series</code></pre>
<p>because that would effectively wipe out the values of all the entries not present in the series.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>na</em>'s in the existing <code>pd.DataFrame</code> are filled in with data from the <em>deleted series</em></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">reindexed_concatenated_df</span><span class="p">[</span><span class="s1">'deleted_on'</span><span class="p">]</span> <span class="o">=</span> <span class="n">reindexed_concatenated_df</span><span class="p">[</span><span class="s1">'deleted_on'</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">deduplicated_reindexed_deleted_series</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The number of <em>non-NAs</em> in the old and new <code>pd.DataFrame</code>s</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n_notnas_old</span><span class="p">,</span> <span class="n">n_notnas_new</span> <span class="o">=</span> <span class="n">bak_reindexed_concatenated_df</span><span class="p">[</span><span class="s1">'deleted_on'</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">reindexed_concatenated_df</span><span class="p">[</span><span class="s1">'deleted_on'</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">n_notnas_old</span><span class="p">,</span> <span class="n">n_notnas_new</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(0, 0)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The latter be larger than or equal than the former</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">n_notnas_new</span> <span class="o">&gt;=</span> <span class="n">n_notnas_old</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The original index is reset (notice the <code>reset_index()</code> in the middle that avoids losing <code>id</code> columns, which is right now the index)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">reindexed_concatenated_df</span> <span class="o">=</span> <span class="n">reindexed_concatenated_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">'file name'</span><span class="p">,</span> <span class="s1">'entry'</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">reindexed_concatenated_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>id</th>
      <th>summary</th>
      <th>title</th>
      <th>updated</th>
      <th colspan="15" halign="left">ContractFolderStatus</th>
      <th>deleted_on</th>
      <th>ContractFolderStatus</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>ContractFolderID</th>
      <th>ContractFolderStatusCode</th>
      <th colspan="2" halign="left">LocatedContractingParty</th>
      <th colspan="2" halign="left">ProcurementProject</th>
      <th>...</th>
      <th>LegalDocumentReference</th>
      <th colspan="2" halign="left">TechnicalDocumentReference</th>
      <th colspan="2" halign="left">LocatedContractingParty</th>
      <th colspan="3" halign="left">TenderingProcess</th>
      <th></th>
      <th>LocatedContractingParty</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">Party</th>
      <th>Name</th>
      <th>TypeCode</th>
      <th>...</th>
      <th>Attachment</th>
      <th>ID</th>
      <th>Attachment</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th colspan="2" halign="left">ParticipationRequestReceptionPeriod</th>
      <th>TenderSubmissionDeadlinePeriod</th>
      <th></th>
      <th>BuyerProfileURIID</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>PartyIdentification</th>
      <th>PartyName</th>
      <th></th>
      <th></th>
      <th>...</th>
      <th>ExternalReference</th>
      <th></th>
      <th>ExternalReference</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th>EndDate</th>
      <th>EndTime</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th></th>
      <th></th>
      <th>...</th>
      <th>URI</th>
      <th></th>
      <th>URI</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th>PartyName</th>
      <th>ParentLocatedParty</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th>Name</th>
      <th>PartyName</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>Name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th>file name</th>
      <th>entry</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">PlataformasAgregadasSinMenores_20180217_180137_1.atom</th>
      <th>453</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Expediente: 1284/17, Entidad: Diputación Provi...</td>
      <td>Refuerzo de Firme en la VP 3001 Renedo de Esgu...</td>
      <td>2018-01-02 08:01:52.024000+00:00</td>
      <td>1284/17</td>
      <td>RES</td>
      <td>L02000047</td>
      <td>Diputación Provincial de Valladolid</td>
      <td>Refuerzo de Firme en la VP 3001 Renedo de Esgu...</td>
      <td>3.0</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2017-11-02</td>
      <td>23:59:00</td>
      <td>2017-11-02 23:59:00+00:00</td>
      <td>NaT</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>452</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Expediente: 1282/17, Entidad: Diputación Provi...</td>
      <td>Refuerzo de Firme en la VP 6603 Mota del Marqu...</td>
      <td>2018-01-02 08:02:24.833000+00:00</td>
      <td>1282/17</td>
      <td>RES</td>
      <td>L02000047</td>
      <td>Diputación Provincial de Valladolid</td>
      <td>Refuerzo de Firme en la VP 6603 Mota del Marqu...</td>
      <td>3.0</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2017-11-02</td>
      <td>23:59:00</td>
      <td>2017-11-02 23:59:00+00:00</td>
      <td>NaT</td>
      <td>&lt;NA&gt;</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 42 columns</p>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A function encompassing all of the above steps in one go</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="parquet_with_zip" class="doc_header"><code>parquet_with_zip</code><a href="https://github.com/manuvazquez/dlsproc/tree/master/dlsproc/extend.py#L19" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parquet_with_zip</code>(<strong><code>history_file</code></strong>:<code>Path</code>[<code>str</code>, <code>Path</code>], <strong><code>zip_file</code></strong>:<code>Path</code>[<code>str</code>, <code>Path</code>], <strong><code>output_file</code></strong>:<code>Path | None</code>[<code>str</code>, <code>Path</code>, <code>NoneType</code>]=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">merged_df</span> <span class="o">=</span> <span class="n">parquet_with_zip</span><span class="p">(</span><span class="n">history_input_file</span><span class="p">,</span> <span class="n">zip_file</span><span class="p">)</span>
<span class="n">merged_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>id</th>
      <th>summary</th>
      <th>title</th>
      <th>updated</th>
      <th colspan="15" halign="left">ContractFolderStatus</th>
      <th>deleted_on</th>
      <th>ContractFolderStatus</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>ContractFolderID</th>
      <th>ContractFolderStatusCode</th>
      <th colspan="2" halign="left">LocatedContractingParty</th>
      <th colspan="2" halign="left">ProcurementProject</th>
      <th>...</th>
      <th>LegalDocumentReference</th>
      <th colspan="2" halign="left">TechnicalDocumentReference</th>
      <th colspan="2" halign="left">LocatedContractingParty</th>
      <th colspan="3" halign="left">TenderingProcess</th>
      <th></th>
      <th>LocatedContractingParty</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">Party</th>
      <th>Name</th>
      <th>TypeCode</th>
      <th>...</th>
      <th>Attachment</th>
      <th>ID</th>
      <th>Attachment</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th colspan="2" halign="left">ParticipationRequestReceptionPeriod</th>
      <th>TenderSubmissionDeadlinePeriod</th>
      <th></th>
      <th>BuyerProfileURIID</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>PartyIdentification</th>
      <th>PartyName</th>
      <th></th>
      <th></th>
      <th>...</th>
      <th>ExternalReference</th>
      <th></th>
      <th>ExternalReference</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th>EndDate</th>
      <th>EndTime</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th></th>
      <th></th>
      <th>...</th>
      <th>URI</th>
      <th></th>
      <th>URI</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th>PartyName</th>
      <th>ParentLocatedParty</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th>Name</th>
      <th>PartyName</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>Name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th>file name</th>
      <th>entry</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">PlataformasAgregadasSinMenores_20180217_180137_1.atom</th>
      <th>453</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Expediente: 1284/17, Entidad: Diputación Provi...</td>
      <td>Refuerzo de Firme en la VP 3001 Renedo de Esgu...</td>
      <td>2018-01-02 08:01:52.024000+00:00</td>
      <td>1284/17</td>
      <td>RES</td>
      <td>L02000047</td>
      <td>Diputación Provincial de Valladolid</td>
      <td>Refuerzo de Firme en la VP 3001 Renedo de Esgu...</td>
      <td>3.0</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2017-11-02</td>
      <td>23:59:00</td>
      <td>2017-11-02 23:59:00+00:00</td>
      <td>NaT</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>452</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Expediente: 1282/17, Entidad: Diputación Provi...</td>
      <td>Refuerzo de Firme en la VP 6603 Mota del Marqu...</td>
      <td>2018-01-02 08:02:24.833000+00:00</td>
      <td>1282/17</td>
      <td>RES</td>
      <td>L02000047</td>
      <td>Diputación Provincial de Valladolid</td>
      <td>Refuerzo de Firme en la VP 6603 Mota del Marqu...</td>
      <td>3.0</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2017-11-02</td>
      <td>23:59:00</td>
      <td>2017-11-02 23:59:00+00:00</td>
      <td>NaT</td>
      <td>&lt;NA&gt;</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 42 columns</p>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We should be getting exactly the same result as above</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">reindexed_concatenated_df</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">merged_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">output_file</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s1">'samples'</span> <span class="o">/</span> <span class="s1">'merged.parquet'</span>
<span class="n">parquet_with_zip</span><span class="p">(</span><span class="n">history_input_file</span><span class="p">,</span> <span class="n">zip_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sample_output_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
<span class="n">sample_output_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>id</th>
      <th>summary</th>
      <th>title</th>
      <th>updated</th>
      <th colspan="15" halign="left">ContractFolderStatus</th>
      <th>deleted_on</th>
      <th>ContractFolderStatus</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>ContractFolderID</th>
      <th>ContractFolderStatusCode</th>
      <th colspan="2" halign="left">LocatedContractingParty</th>
      <th colspan="2" halign="left">ProcurementProject</th>
      <th>...</th>
      <th>LegalDocumentReference</th>
      <th colspan="2" halign="left">TechnicalDocumentReference</th>
      <th colspan="2" halign="left">LocatedContractingParty</th>
      <th colspan="3" halign="left">TenderingProcess</th>
      <th></th>
      <th>LocatedContractingParty</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">Party</th>
      <th>Name</th>
      <th>TypeCode</th>
      <th>...</th>
      <th>Attachment</th>
      <th>ID</th>
      <th>Attachment</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th colspan="2" halign="left">ParticipationRequestReceptionPeriod</th>
      <th>TenderSubmissionDeadlinePeriod</th>
      <th></th>
      <th>BuyerProfileURIID</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>PartyIdentification</th>
      <th>PartyName</th>
      <th></th>
      <th></th>
      <th>...</th>
      <th>ExternalReference</th>
      <th></th>
      <th>ExternalReference</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th>EndDate</th>
      <th>EndTime</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th></th>
      <th></th>
      <th>...</th>
      <th>URI</th>
      <th></th>
      <th>URI</th>
      <th colspan="2" halign="left">ParentLocatedParty</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th>PartyName</th>
      <th>ParentLocatedParty</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th>Name</th>
      <th>PartyName</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>...</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>Name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th>file name</th>
      <th>entry</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">PlataformasAgregadasSinMenores_20180217_180137_1.atom</th>
      <th>453</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Expediente: 1284/17, Entidad: Diputación Provi...</td>
      <td>Refuerzo de Firme en la VP 3001 Renedo de Esgu...</td>
      <td>2018-01-02 08:01:52.024000+00:00</td>
      <td>1284/17</td>
      <td>RES</td>
      <td>L02000047</td>
      <td>Diputación Provincial de Valladolid</td>
      <td>Refuerzo de Firme en la VP 3001 Renedo de Esgu...</td>
      <td>3.0</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2017-11-02</td>
      <td>23:59:00</td>
      <td>2017-11-02 23:59:00+00:00</td>
      <td>None</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>452</th>
      <td>https://contrataciondelestado.es/sindicacion/P...</td>
      <td>Expediente: 1282/17, Entidad: Diputación Provi...</td>
      <td>Refuerzo de Firme en la VP 6603 Mota del Marqu...</td>
      <td>2018-01-02 08:02:24.833000+00:00</td>
      <td>1282/17</td>
      <td>RES</td>
      <td>L02000047</td>
      <td>Diputación Provincial de Valladolid</td>
      <td>Refuerzo de Firme en la VP 6603 Mota del Marqu...</td>
      <td>3.0</td>
      <td>...</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>2017-11-02</td>
      <td>23:59:00</td>
      <td>2017-11-02 23:59:00+00:00</td>
      <td>None</td>
      <td>&lt;NA&gt;</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 42 columns</p>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let us make sure nothing was lost</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">sample_output_df</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>


