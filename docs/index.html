---

title: dlsproc


keywords: fastai
sidebar: home_sidebar

summary: "Download Spanish procurement"
description: "Download Spanish procurement"
nb_path: "index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For the time being the name of the package is a misnomer, since this is Python code meant to <em>parse</em> Spanish government's <a href="https://contrataciondelestado.es">Plataforma de contratación del sector público</a> <em>metadata</em> (right now, it does <strong>not</strong> download any document). It is meant to take as input a <em>zip</em> file packaging many <a href="https://en.wikipedia.org/wiki/Atom_(web_standard">ATOM</a>) (a somehow cumbersome format) files, downloaded through <a href="https://www.hacienda.gob.es/es-ES/GobiernoAbierto/Datos%20Abiertos/Paginas/licitaciones_plataforma_contratacion.aspx">Ministerio de Hacienda y Función Pública</a>, and produce <a href="https://parquet.apache.org/">parquet</a> files that can be easily read in many programming languages.</p>
<p>This project was developed with <a href="https://github.com/fastai/nbdev">nbdev</a> (v1), and hence each module stems from a <a href="https://jupyter.org/">Jupyter</a> notebook that contains the code, along with tests and documentation. If you are interested in the inner workings of any module you can check its corresponding notebook in the corresponding section of the <a href="https://manuvazquez.github.io/dlsproc/">github pages</a> of the project.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

<pre><code>pip install git+https://github.com/manuvazquez/dlsproc@master</code></pre>
<p>should do.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The software can be exploited as a library or as <em>standalone</em> scripts.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Scripts">Scripts<a class="anchor-link" href="#Scripts"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For testing purposes one can download <em>Outsiders contracts for 2018</em>, either directly by clicking <a href="https://contrataciondelsectorpublico.gob.es/sindicacion/sindicacion_1044/PlataformasAgregadasSinMenores_2018.zip">this link</a> or, if <a href="https://www.gnu.org/software/wget/">wget</a> is available, running</p>

<pre><code>wget https://contrataciondelsectorpublico.gob.es/sindicacion/sindicacion_1044/PlataformasAgregadasSinMenores_2018.zip</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Processing-a-single-zip-file">Processing a single zip file<a class="anchor-link" href="#Processing-a-single-zip-file"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Running</p>

<pre><code>dlsproc_process_zip.py PlataformasAgregadasSinMenores_2018.zip 2018.parquet</code></pre>
<p>outputs the file <code>2018.parquet</code> (the name being given by the 2nd argument), which contains a <code>pd.DataFrame</code> with all the 2018 metadata. It can be readily loaded (in Python, through <a href="https://pandas.pydata.org/">Pandas</a>' <code>pd.read_parquet</code>). The columns of the <code>pd.DataFrame</code> stored inside are <em>multiindexed</em> (meaning one could get columns such as <code>(ContractFolderStatus','ContractFolderID)</code> and <code>(ContractFolderStatus','ContractFolderStatusCode)</code>.  This is very convenient when visualizing the data (see the <a href="https://manuvazquez.github.io/dlsproc/hierarchical.html#flat_df_to_multiindexed_df">the documentation for the <code>hier</code>module</a>).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="From-hierarchical-(multiindexed)-columns-to-plain-ones">From hierarchical (<em>multiindexed</em>) columns to plain ones<a class="anchor-link" href="#From-hierarchical-(multiindexed)-columns-to-plain-ones"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The columns of the above <code>pd.DataFrame</code> can be <em>flattened</em> to get, in the example above, <code>ContractFolderStatus - ContractFolderID</code> and <code>ContractFolderStatus - ContractFolderStatusCode</code>, respectively. Additionally, some renaming might be applied following the mapping in some YAML file</p>

<pre><code>dlsproc_rename_cols.py 2018.parquet samples/PLACE.yaml 2018_flattened.parquet</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This would yield a <code>pd.DataFrame</code> with <em>plain</em> columns in file <code>2018_flattened.parquet</code>. Renaming is carried out using the mapping in <a href="https://github.com/manuvazquez/dlsproc/blob/master/samples/PLACE.yaml">PLACE.yaml</a>, which can be found in the <code>samples</code> directory of this repository.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Processing-a-list-of-zip-files">Processing a list of zip files<a class="anchor-link" href="#Processing-a-list-of-zip-files"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Command <code>dlsproc_read_zips.py</code> can be used to <em>batch</em>-process a sequence of files, e.g.,</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

<pre><code>dlsproc_read_zips.py contratosMenoresPerfilesContratantes_2018.zip contratosMenoresPerfilesContratantes_2019.zip</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If no output file is specified (through the <code>-o</code> option), an <code>out.parquet</code> file (in which all the entries of all the zip files are stitched together) is produced.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Appending-new-data-to-an-existing-(column-multiindexed)-parquet-file">Appending new data to an existing (column-<em>multiindexed</em>) <em>parquet</em> file<a class="anchor-link" href="#Appending-new-data-to-an-existing-(column-multiindexed)-parquet-file"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can append new data to an existing <code>pd.DataFrame</code>. Let us, for instance, download, <a href="https://contrataciondelsectorpublico.gob.es/sindicacion/sindicacion_1044/PlataformasAgregadasSinMenores_202201.zip">data from January 2022</a>,</p>

<pre><code>wget https://contrataciondelsectorpublico.gob.es/sindicacion/sindicacion_1044/PlataformasAgregadasSinMenores_202201.zip</code></pre>
<p>and extend the previous <em>parquet</em> file with data extracted from the newly downloaded <em>zip</em>,</p>

<pre><code>dlsproc_extend_parquet_with_zip.py 2018.parquet PlataformasAgregadasSinMenores_202201.zip 2018_202201.parquet</code></pre>
<p>The <em>combined</em> data was saved in <code>2018_202201.parquet</code>.</p>

</div>
</div>
</div>
</div>


